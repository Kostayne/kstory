{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"name": "KStory",
	"scopeName": "source.kstory",
	"patterns": [
		{
			"include": "#comments"
		},
		{
			"include": "#sections"
		},
		{
			"include": "#replicas"
		},
		{
			"include": "#choices"
		},
		{
			"include": "#calls"
		},
		{
			"include": "#tags"
		},
		{
			"include": "#gotos"
		},
		{
			"include": "#strings"
		}
	],
	"repository": {
		"comments": {
			"patterns": [
				{
					"name": "comment.line.number-sign.kstory",
					"match": "#.*$"
				},
				{
					"name": "comment.block.kstory",
					"begin": "/\\*",
					"end": "\\*/"
				}
			]
		},
		"sections": {
			"patterns": [
				{
					"name": "entity.name.section.kstory",
					"match": "^==\\s*(.+?)(?=\\s*#|$)"
				}
			]
		},
		"replicas": {
			"patterns": [
				{
					"name": "string.quoted.double.kstory",
					"begin": "\"\\s",
					"end": "(?=\\s*->|\\s*=>|\\s*@|\\s*\"|$)",
					"patterns": [
						{
							"include": "#inline-calls"
						}
					]
				}
			]
		},
		"choices": {
			"patterns": [
				{
					"name": "keyword.control.choice.kstory",
					"match": "^\\+\\s"
				},
				{
					"name": "string.quoted.triple.kstory",
					"begin": "```",
					"end": "```",
					"patterns": [
						{
							"name": "string.content.kstory"
						}
					]
				}
			]
		},
		"calls": {
			"patterns": [
				{
					"name": "keyword.control.call.kstory",
					"match": "@call:"
				},
				{
					"name": "entity.name.function.kstory",
					"match": "(?<=@call:)\\w+"
				}
			]
		},
		"inline-calls": {
			"patterns": [
				{
					"name": "keyword.control.inline-call.kstory",
					"match": "\\{call:"
				},
				{
					"name": "entity.name.function.inline.kstory",
					"match": "(?<=\\{call:)\\w+"
				}
			]
		},
		"tags": {
			"patterns": [
				{
					"name": "variable.parameter.kstory",
					"match": "@@\\w+"
				},
				{
					"name": "variable.other.kstory",
					"match": "@\\w+"
				}
			]
		},
		"gotos": {
			"patterns": [
				{
					"name": "keyword.control.goto.kstory",
					"match": "->\\s"
				},
				{
					"name": "keyword.control.goto.kstory",
					"match": "=>\\s"
				},
				{
					"name": "entity.name.section.reference.kstory",
					"match": "(?<=->\\s|=>\\s)[\\w\\-,]+"
				}
			]
		},
		"strings": {
			"patterns": [
				{
					"name": "string.quoted.double.kstory",
					"begin": "\"",
					"end": "\"",
					"patterns": [
						{
							"name": "constant.character.escape.kstory",
							"match": "\\\\."
						}
					]
				}
			]
		}
	}
}
